{% extends 'base.html' %}
{% load static %}

{% block title %}Dashboard - QuantoGastei{% endblock %}

{% block content %}
<div class="container-app">
    <!-- Header Moderno -->
    <div class="app-header">
        <h1>QuantoGastei</h1>
        <p>Ol√°, <span id="user-name">Usu√°rio</span>! üëã</p>
    </div>

    <!-- Selector de Contas -->
    <div class="contas-selector" id="contasSelector">
        <div class="loading"></div>
    </div>

    <!-- Bot√µes de A√ß√£o Principais - DESTAQUE -->
    <div class="action-buttons">
        <button class="action-btn receita" onclick="abrirModal('receita')">
            <div class="action-btn-icon">
                <span class="material-symbols-outlined">add</span>
            </div>
            <span class="action-btn-text">Receita</span>
        </button>

        <button class="action-btn despesa" onclick="abrirModal('despesa')">
            <div class="action-btn-icon">
                <span class="material-symbols-outlined">remove</span>
            </div>
            <span class="action-btn-text">Despesa</span>
        </button>

        <button class="action-btn transferencia" onclick="abrirModal('transferencia')">
            <div class="action-btn-icon">
                <span class="material-symbols-outlined">swap_horiz</span>
            </div>
            <span class="action-btn-text">Transferir</span>
        </button>
    </div>

    <!-- Resumo Mensal -->
    <div class="resumo-mensal">
        <div class="resumo-header">
            <h2 class="resumo-mes" id="resumoMes">Carregando...</h2>
            <span class="contador-badge" id="contadorTransacoes">0 transa√ß√µes</span>
        </div>

        <div class="resumo-cards">
            <div class="resumo-card receita">
                <div class="resumo-card-label">Receitas</div>
                <div class="resumo-card-valor" id="totalReceitas">R$ 0,00</div>
            </div>

            <div class="resumo-card despesa">
                <div class="resumo-card-label">Despesas</div>
                <div class="resumo-card-valor" id="totalDespesas">R$ 0,00</div>
            </div>

            <div class="resumo-card saldo">
                <div class="resumo-card-label">Saldo do M√™s</div>
                <div class="resumo-card-valor" id="saldoMes">R$ 0,00</div>
            </div>
        </div>
    </div>

    <!-- Gr√°fico Pizza -->
    <div class="grafico-container">
        <h3>Gastos por Categoria</h3>
        <div class="grafico-wrapper">
            <canvas id="chartCategoria" width="400" height="300"></canvas>
        </div>
    </div>

    <!-- √öltimos Registros -->
    <div class="ultimos-registros">
        <h3>√öltimos Registros</h3>
        <div id="ultimasTransacoes">
            <!-- Skeleton loading -->
            <div class="skeleton-container">
                <div class="skeleton-item">
                    <div class="skeleton-icon"></div>
                    <div class="skeleton-text">
                        <div class="skeleton-line skeleton-line-title"></div>
                        <div class="skeleton-line skeleton-line-subtitle"></div>
                    </div>
                    <div class="skeleton-value"></div>
                </div>
                <div class="skeleton-item">
                    <div class="skeleton-icon"></div>
                    <div class="skeleton-text">
                        <div class="skeleton-line skeleton-line-title"></div>
                        <div class="skeleton-line skeleton-line-subtitle"></div>
                    </div>
                    <div class="skeleton-value"></div>
                </div>
                <div class="skeleton-item">
                    <div class="skeleton-icon"></div>
                    <div class="skeleton-text">
                        <div class="skeleton-line skeleton-line-title"></div>
                        <div class="skeleton-line skeleton-line-subtitle"></div>
                    </div>
                    <div class="skeleton-value"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bottom Navigation -->
    <nav class="bottom-nav">
        <a href="{% url 'home' %}" class="nav-item active">
            <span class="material-symbols-outlined">home</span>
            <span>In√≠cio</span>
        </a>
        <a href="{% url 'contas' %}" class="nav-item">
            <span class="material-symbols-outlined">account_balance_wallet</span>
            <span>Contas</span>
        </a>
        <a href="{% url 'transacoes' %}" class="nav-item">
            <span class="material-symbols-outlined">receipt_long</span>
            <span>Hist√≥rico</span>
        </a>
        <a href="{% url 'configuracoes' %}" class="nav-item">
            <span class="material-symbols-outlined">settings</span>
            <span>Config</span>
        </a>
    </nav>
</div>

<!-- Toast Notification -->
<div id="toast" class="toast">
    <span class="material-symbols-outlined" id="toast-icon">check_circle</span>
    <span id="toast-message">Sucesso!</span>
</div>

<!-- Modal Nova Transa√ß√£o -->
<div id="modalTransacao" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2 id="modalTitle">Nova Transa√ß√£o</h2>
            <button class="modal-close" onclick="fecharModal()">&times;</button>
        </div>
        
        <form id="formTransacao">
            <input type="hidden" id="tipoTransacao" name="tipo">
            
            <div class="form-group">
                <label for="descricao">Descri√ß√£o</label>
                <input type="text" id="descricao" class="form-control" required placeholder="Ex: Almo√ßo no restaurante">
            </div>

            <div class="form-group">
                <label for="valor">Valor</label>
                <input type="number" id="valor" class="form-control" step="0.01" min="0" required placeholder="0,00">
            </div>

            <div class="form-group">
                <label for="data">Data</label>
                <input type="date" id="data" class="form-control" required>
            </div>

            <div class="form-group">
                <label for="conta_origem">Conta</label>
                <select id="conta_origem" class="form-control" required>
                    <option value="">Selecione uma conta</option>
                </select>
            </div>

            <div class="form-group" id="grupoContaDestino" style="display: none;">
                <label for="conta_destino">Conta Destino</label>
                <select id="conta_destino" class="form-control">
                    <option value="">Selecione uma conta</option>
                </select>
            </div>

            <div class="form-group" id="grupoCategoria">
                <label for="categoria">Categoria</label>
                <select id="categoria" class="form-control">
                    <option value="">Selecione uma categoria</option>
                </select>
            </div>

            <div class="form-group">
                <label for="observacoes">Observa√ß√µes (opcional)</label>
                <textarea id="observacoes" class="form-control" rows="2" placeholder="Adicione uma nota sobre essa transa√ß√£o"></textarea>
            </div>

            <button type="submit" class="btn btn-primary">Salvar Transa√ß√£o</button>
        </form>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
<script src="{% static 'js/api.js' %}"></script>
<script src="{% static 'js/dashboard.js' %}"></script>
{% endblock %}